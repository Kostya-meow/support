# Объяснение функции "Активен"

## Что это такое?

Кнопка **"Активен"** (галочка в админ-панели) управляет статусом пользователя в системе.

### Два состояния:

✅ **Активен** (`is_active = true`)
- Пользователь может войти в систему
- Все функции доступны
- Пользователь виден как "✓ Активен" в таблице

✗ **Неактивен** (`is_active = false`)  
- Пользователь **НЕ МОЖЕТ** войти в систему
- При попытке входа получит ошибку авторизации
- Пользователь виден как "✗ Неактивен" в таблице

---

## Зачем это нужно?

### 1. Временное отключение доступа
Например, сотрудник:
- В отпуске
- На больничном
- Временно не работает

Вместо удаления аккаунта (потеря всей истории) - просто деактивируем.

### 2. Увольнение сотрудника
Когда человек увольняется:
- Деактивируем аккаунт
- История остается в системе
- При необходимости можно восстановить

### 3. Блокировка нарушителя
Если сотрудник нарушает правила:
- Временно отключаем доступ
- Разбираемся в ситуации
- Потом активируем снова или удаляем

---

## В чем разница с удалением?

| Действие | Активен | Деактивирован | Удален |
|----------|---------|---------------|--------|
| Может войти | ✅ Да | ❌ Нет | ❌ Нет |
| Виден в списке | ✅ Да | ✅ Да | ❌ Нет |
| История сохранена | ✅ Да | ✅ Да | ❌ Нет |
| Можно восстановить | - | ✅ Да (одна галочка) | ❌ Нет |

---

## Как использовать?

### Деактивировать пользователя:
1. Нажмите "Редактировать"
2. Снимите галочку "Активен"
3. Нажмите "Сохранить"
4. Пользователь больше не сможет войти

### Активировать обратно:
1. Нажмите "Редактировать"  
2. Поставьте галочку "Активен"
3. Нажмите "Сохранить"
4. Пользователь снова может войти

---

## Технические детали

### Проверка при входе:
```python
# В app/permissions.py
def get_current_user_from_request(request):
    user = user_manager.get_user_by_id(user_id)
    
    # Проверяем активность!
    if user and not user.get('is_active'):
        return None  # Доступ запрещен
    
    return user
```

### Проверка паролей:
```python
# В app/user_manager.py
def verify_password(username, password):
    user = get_user_by_username(username)
    
    # Неактивные пользователи не могут войти
    if not user or not user.get('is_active'):
        return None
    
    # ... проверка пароля
```

---

## Примеры использования

### Пример 1: Сотрудник в отпуске
```
1. Иван Петров уходит в отпуск на 2 недели
2. Деактивируем его аккаунт
3. Через 2 недели активируем обратно
4. Все его настройки и права сохранены
```

### Пример 2: Уволенный сотрудник
```
1. Мария Иванова уволилась
2. Деактивируем аккаунт (не удаляем!)
3. Через полгода нужна статистика по ее работе
4. Заходим в админку, видим все ее данные
5. Аккаунт остается деактивированным навсегда
```

### Пример 3: Подозрительная активность
```
1. Замечена странная активность от аккаунта "operator5"
2. Немедленно деактивируем
3. Проводим расследование
4. Если все ок - активируем обратно
5. Если нет - удаляем аккаунт
```

---

## Рекомендации

✅ **Делайте так:**
- Деактивируйте временно отсутствующих
- Деактивируйте уволенных (не удаляйте сразу)
- Деактивируйте при подозрении на взлом

❌ **Не делайте так:**
- Не удаляйте аккаунты без крайней необходимости
- Не оставляйте активными аккаунты уволенных
- Не деактивируйте без причины (сотрудник не сможет работать)

---

## FAQ

**Q: Можно ли деактивировать главного админа?**  
A: Нет, системный администратор (ID=1) защищен от любых изменений.

**Q: Что происходит с активными сессиями?**  
A: При следующем запросе пользователь получит ошибку 401 и будет выкинут на login.

**Q: Можно ли массово деактивировать?**  
A: Пока нет, только по одному через интерфейс.

**Q: Видны ли деактивированные в списке?**  
A: Да, они отображаются с меткой "✗ Неактивен" серым цветом.

**Q: Потеряются ли данные при деактивации?**  
A: Нет, все данные сохраняются. Это не удаление!

---

**Важно:** Деактивация - это "мягкая блокировка". Используйте ее вместо удаления, чтобы сохранить историю и иметь возможность восстановить доступ.
